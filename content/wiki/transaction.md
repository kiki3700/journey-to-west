---
title: Transaction
slug: "transaction"
---

## 개념

- **트랜잭션** 은 데이터베이스 시스템에서 일련의 연산이 성공적으로 완성되거나 실패하도록 보장하는 작업단위, 트랜잭션을 통해, 데이터베이스 무결성, 일관성이 유지되는데 중요한 역할을 한다.

## 트랜잭션 특성

- 트랜잭션의 ACID 특징을 가져야한다.

### Atomicity(원자성)

- 트랜잭션 내의 모든 작업은 완전히 수행되거나 완전히 수행되지 않아야한다. 즉 트랜잭션의 모든 연산은 하나의 단위로 처리되어야하며, 하나라도 실패하면 전체 트랜잭션을 취소하고 이전 상태로 복구되어야한다.

### Consistency(일관성)

- 트랜잭션이 시작되기 전과 후 데이터 모순이 없는 상태를 유지해야된다.
  - 데이터 베이스의 제약조건을 만족해야한다.
  - 어플리케이션이 의도한 동작이 작동해야한다.

### Isolation(격리성)

- 트랜잭션 간의 격리 수준을 제공하여 여러 트랜잭션이 동시에 수행되더라도 각각 독립적으로 실행되도록 보장한다.

### Durability(지속성)

- 커밋된 트랜잭션의 내용을 영구적으로 저장해야한다.

LazyInitializationException

## JPA 트랜잭션 어노테이션

- `Transactional`을 사용해 트랜젝션 범위를 설정하고, 트랜잭션의 관리정책을 설정할 수 있다.
- 트랜잭션은 데이터베이스 **sssion**의 단위이다. LazyLoading 설정시, 트랜잭션 처리를 하지 않았다면, `LazyInitializationException`이 발생한다.
- 메서드 수준과 클래스 수준에서 사용할 수 있다.

### 주요 속성

1. propagation (전파 수준): 전파 수준은 현재 트랜잭션이 존재하는지 여부와 어떻게 결합할지 결정한다.
   - REQUIRED (기본값): 현재 트랜잭션이 존재하면 참여하고, 없으면 새로운 트랜잭션을 시작합니다.
   - REQUIRES_NEW: 항상 새로운 트랜잭션을 시작하며, 현재 트랜잭션이 존재하면 일시 중지합니다.
   - MANDATORY: 현재 트랜잭션이 반드시 존재해야 하며, 없으면 예외를 발생시킵니다.
   - SUPPORTS: 현재 트랜잭션이 존재하면 참여하고, 없으면 트랜잭션 없이 실행됩니다.
   - NOT_SUPPORTED: 현재 트랜잭션이 존재하면 일시 중지하고, 트랜잭션 없이 실행됩니다.
   - NEVER: 현재 트랜잭션이 존재하면 예외를 발생시키며, 트랜잭션 없이 실행됩니다.
   - NESTED: 현재 트랜잭션이 존재하면 중첩된 트랜잭션으로 실행되고, 없으면 새로운 트랜잭션을 시작합니다.
2. isolation (격리 수준) : 동시에 실행되는 여러 트랜잭션 간의 데이터 일관성을 관리한다.
   - DEFAULT: 데이터베이스의 기본 격리 수준을 따릅니다.
   - READ_UNCOMMITTED: 다른 트랜잭션이 커밋하지 않은 변경 내용도 읽을 수 있습니다.
   - READ_COMMITTED: 다른 트랜잭션이 커밋한 데이터만 읽을 수 있습니다.
   - REPEATABLE_READ: 트랜잭션 동안 읽은 데이터가 변경되지 않도록 보장합니다.
   - SERIALIZABLE: 가장 엄격한 격리 수준으로, 트랜잭션 간의 완벽한 분리를 보장합니다.
3. timeout : 트랜잭션이 롤백되기 전에 완료되어야 하는 시간을 초단위로 설정 (기본값은 데이터베이스 설정)
4. readOnly: 트랜잭션이 읽기전용임을 나타낸다. 읽기 성능을 최적화 할 수 있다.

## 트랜잭션의 고려사항

1. 성능저하: 트랜잭션은 자원 잠금과 동시성 제어 메카니즘을 사용하여 데이터 베이스 성능을 저하시킬 수 있다.
2. 복잡성 증가: 개발자는 트랜잭션의 경계, 전파 수준, 격리 수준을 고려하여야한다.
3. 데드락 가능성: 두개 이상의 트랜잭션이 서로의 자원을 기다리며 무한 대기 상태에 빠질 수 있다.
