---
title: Jvm Runtime data area
slug: 'jvm-runtime-data-area'
---
* **런타임 데이터 영역**은 **JVM의 메모리 영역**으로 자바 애플리케이션을 실행할 때 사용되는 데이터들을 적재하는 영역이다.

| 영역                         | 용도                                                                                                                                  | 사용기간                                            | 스레드 공유             |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|---------------------|
| **Method(Static)**            | JVM에서 읽어들인 클래스와 인터페이스에 대한 런타임 상수 풀, 메서드와 필드, Static 변수, 메서드 바이트 코드 등을 보관                                              | JVM 시작시 생성<br>프로그램 종료 시까지<br>명시적으로 null 선언시 GC 대상 | 모든 스레드에서 공유    |
| **Runtime Constant Pool**     | Method Area 영역에 포함되지만 독자적 용량을 쓴다.<br> 클래스 내 상수값, 메서드 참조에 대한 런타임 인스턴스 저장.<br> JVM은 런타임 상수를 참조할 때 메서드나 필드의 실제 메모리 주소를 찾아 참조 | JVM 시작시 생성<br>명시적으로 null 선언시 GC 대상  | 모든 스레드에서 공유    |
| **Heap Area**                 | 프로그램 상에서 데이터를 저장하기 위해 런타임 시 동적으로 할당하여 사용하는 메모리 영역<br>동적으로 생성된 객체, 인스턴스 등이 저장                                 | 객체가 더 이상 사용되지 않거나 명시적으로 null 선언시 GC 대상<br>구현 방식에 따라 다를 수 있음 | JVM에 따라 다를 수 있음 |
| **Stack Area**                | 선입후출(FILO) 구조. 메서드 호출 시 스택 프레임을 스택으로 수행 정보를 기록하는 구조<br>Frame 저장, 지역변수, 임시 데이터 저장                                  | 하나의 메서드가 끝날 때까지 유지                      | 각 스레드별로 생성      |
| **PC 레지스터**                | 현재 실행 중인 JVM 주소를 가지고 있다.<br>CPU 명령어와 Instruction을 저장 및 실행하여 CPU나 기록장치에 저장.<br>연산 및 결과값을 메모리에 전달하기 전 CPU나 기록장치에 저장     | 메서드가 끝날 때까지 유지                          | 각 스레드별로 생성      |
| **Native Method Stack Area**  | 자바 외의 언어로 작성된 네이티브 코드를 실행하기 위한 메모리 영역<br>native 메서드의 매개변수, 지역변수, 결과값 등을 바이트코드로 저장                        | native interface 호출 시 생성<br>native interface 종료 시 소멸 | 각 스레드별로 생성      |

### 메서드 영역(Method Area)
**메서드 영역**은 JVM이 시작될 때 생성되는 공간으로 바이트 코드(.class)를 처음 메모리 공간에 올릴 때 초기화되는 대상을 저장하기 위한 메모리 공간이다.
JVM이 동작하고 클래스가 로드될 대 적재되서 **프로그램이 종료될 때까지 저장** 된다.

* 모든 쓰레드가 공유하는 영역이라 다음과 같이 초기화 코드 정보들이 저장된다.
1. Field Info: 멤버 변수의 이름, 데이터 타입, 접근 제어자의 정보
2. Method Info: 메소드 이름, return 타입, 함수 매개변수, 접근 제어자의 정보
3. Type Info: `Class/Interface` 여부, `Type`의 속성, 이름, `Super Class` 이름
4. static 변수
정적 필드와 클래스 구조를 저장

### 런타임 상수풀
메서드 영역의 일부로, 클래스나 인터페이스 **상수**와 **심볼릭 참조**를 저장하는 영역
* 메서드 영역에 포함되지만 독립적으로 관리된다. 상수와 심볼릭 참조를 저장하여 메서드 실행 시 빠르게 참조할 수 있게 한다.
* 역할:
	* 중복 제거: 문자열, 숫자 리터럴과 같은 상수를 공유하여 메모리 사용량을 줄인다.
	* 심볼릭 참조 저장: 클래스, 메섣, 필드에 대한 참조 정보를 저장한다.
	* 런타임 상수 관리: 실행 중 필요한 상수나 참조 정보를 빠르게 조회할 수 있도록 한다.
* **심볼릭 참조** : 물리적 메모리 주소 대신 이름, 문자열, 인덱스 같은 논리적 기호를 사용해 참조하는것

### 힙 영역(Heap Area)
* **힙 영역**은 메서드 영역과 함께 모든 쓰레드가 공유, JVM이 관리하는 프로그램 상에서 데이터를 저장하기 위해 런타임시 동적으로 할당하여 사용하는 영역
* `new` 연산자로 생성되는 클래스와 인스턴스 변수, 배열 타입 등 `Reference Type`이 저장
* JVM 스택 영역의 변수나 다른 객체의 필드에서 참조
* **가비지 콜렉션**의 대상으로 참조하는 변수나 필드가 없다면, GC 실행시 힙 영역에서 제거된다.

### 스택 영역(Stack Area)
* int, long, boolean 등 기본 자료형을 생성할 때 저장하는 공간으로 임시적으로 사용되는 변수나 정보들이 저장된다.
* 자료 구조 Stack과 같이 마지막에 들어온 앖이 먼저 나가는 LIFO 구조로 `push`와 `pop` 기능 사용 방식으로 동작
* 메서드 호출 시마다 각각의 `스택 프레임`이 생성되고 메서드안에서 사용되는 값들을 저장하고, 호출된 메서드의 매개변수, 지역변수, 리턴 값 및 연산시 일어나는 값들을 임시로 저장한다.
* 메서드 수행이 끝나면 프레임별로 삭제된다.
#### 힙 영역과 차이
1. 기본(원시)타입 변수는 스택 영역에 직접 값을 가진다.
2. 참조타입 변수는 힙 영역이나 메소드 영역의 객체 주소를 가진다.
* 스택 영역은 각 스레드마다 하나씩 존재하며, 스레드가 시작할 때 할당된다.
	* 프로세스가 메모리에 로드될 때 스택사이즈가 고저오디어 있어, 런타임 시에 스택사이즈를 바꿀 수 없다.
	* 메모리 크기가 충분하지 않다면 `StackOverFlowError`가 발생하게된다.
### PC 레지스터 (Program Counter Register)
* `PC 레지스터`는 쓰레드가 시작될 때 시작되며, **현재 수행중인 JVM 명령어 주소를 저장**하는 공간
* 명령어의 실행 흐름을 제어하는 역할
1. 명령어 순서 관리 : app은 여러 명령어로 이뤄져있으며 명령어는 차례대로 실행, PC 레지스터는 현재 실행중인 명령어의 주소를 저장해 JVM이 다음에 어떤 명령어를 실행해야되는 알려준다.
2. 스레드 간 독립적인 명령어 실행
* 멀티스레드 환경에서 각 스레드간 독립적으로 명령어를 추적하고 실행할 수 있도록 자신의 실행 흐름을 따로 관리할 수 있게한다.
3. 조건문과 반복문의 분기 처리
4. 메서드 호출 및 반환 관리
* 메서드 호출 전후의 명령어 위치를 기록, 메서드 호출시 현재 PC레지스터 값이 스택에 저장되고, 메서드가 완료되면 저장된 PC 레지스터 값으로 돌아가 흐름을 계속 실행

### 네이티브 메서드 스택(Native Method Stack)
* **네이티브 메서드 스택**은 자바 코드가 컴파일 되어 생성되는 바이트 코드가 아닌 실제 실행할 수 있는 기계어로 작성된 프로그램을 실행 시키는 영역
* 자바 이외의 언어로 작성된 네이티브 코드를 실행 하기 위한 공간
* 일반적으로 C스택을 사용한다.

